<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</title>

    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/worktime_add.css}">

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("worktimeForm");

            form.addEventListener("submit", async function (e) {
                e.preventDefault();

                const formData = {
                    employeeId: form.querySelector('[name="employeeId"]').value,
                    workDate: form.querySelector('[name="workDate"]').value,
                    hoursWorked: form.querySelector('[name="hoursWorked"]').value
                };

                try {
                    const response = await fetch("/employees/work-time/add", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        showNotification("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞", "error");
                        return;
                    }

                    showNotification("–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!", "success");
                    form.reset();

                } catch (err) {
                    console.error(err);
                    showNotification("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "error");
                }
            });
        });

        function showNotification(message, type) {
            let notif = document.getElementById('form-notification');
            if (!notif) {
                notif = document.createElement('div');
                notif.id = 'form-notification';
                notif.className = 'notification';

                const form = document.getElementById('worktimeForm');
                form.parentNode.insertBefore(notif, form);
            }

            notif.textContent = message;
            notif.className = `notification ${type}`;

            setTimeout(() => notif.classList.add('show'), 10);

            setTimeout(() => {
                notif.classList.remove('show');
                setTimeout(() => {
                    if (notif.parentNode) {
                        notif.parentNode.removeChild(notif);
                    }
                }, 300);
            }, 5000);
        }
    </script>
</head>

<body>

<div th:replace="~{fragments/sidebar :: sidebar}"></div>

<div class="main-content">
    <h1>–£—á—ë—Ç —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h1>

    <form id="worktimeForm" class="worktime-form" th:object="${workTimeForm}">

        <div class="form-group">
            <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</label>
            <select th:field="*{employeeId}" required>
                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</option>
                <option th:each="emp : ${employees}"
                        th:value="${emp.employeeId}"
                        th:text="${emp.surname + ' ' + emp.name + ' ' + emp.patronymic}">
                </option>
            </select>
        </div>

        <div class="form-group">
            <label>–î–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã</label>
            <input type="date" th:field="*{workDate}" required>
        </div>

        <div class="form-group">
            <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤</label>
            <input type="number" step="0.1" min="0" th:field="*{hoursWorked}" required>
        </div>

        <button type="submit" class="submit-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

    </form>
</div>

</body>
</html>
