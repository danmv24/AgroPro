<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</title>

  <link rel="stylesheet" th:href="@{/css/sidebar.css}">
  <link rel="stylesheet" th:href="@{/css/employee_add.css}">
</head>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('employeeForm');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();


      const formData = {
        surname: form.elements['surname']?.value || '',
        name: form.elements['name']?.value || '',
        patronymic: form.elements['patronymic']?.value || '',
        position: form.elements['position']?.value || '',
        paymentType: form.elements['paymentType']?.value || '',
        salary: form.elements['salary']?.value ? parseFloat(form.elements['salary'].value) : null,
        hireDate: form.elements['hireDate']?.value || ''
      };


      if (!formData.surname.trim() || !formData.name.trim() ||
              !formData.salary || !formData.hireDate) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
      }

      const submitBtn = form.querySelector('.submit-btn');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'üïó –û—Ç–ø—Ä–∞–≤–∫–∞...';

      try {
        const response = await fetch(form.action, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok && result.status === 'success') {
          showNotification('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
          form.reset();
        } else {
          const message = result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
          showNotification(message, 'error');
        }
      } catch (error) {
        console.error('AJAX error:', error);
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });
  });

  function showNotification(message, type) {
    let notif = document.getElementById('form-notification');
    if (!notif) {
      notif = document.createElement('div');
      notif.id = 'form-notification';
      notif.className = 'notification';
      const form = document.getElementById('employeeForm');
      form.parentNode.insertBefore(notif, form);
    }

    notif.textContent = message;
    notif.className = `notification ${type}`;

    setTimeout(() => notif.classList.add('show'), 10);

    setTimeout(() => {
      notif.classList.remove('show');
      setTimeout(() => {
        if (notif.parentNode) {
          notif.parentNode.removeChild(notif);
        }
      }, 300);
    }, 5000);
  }
</script>

<body>
<div th:replace="~{fragments/sidebar :: sidebar}"></div>

<div id="notification" class="notification success" style="display: none;">
  <span id="notification-text"></span>
</div>

<div class="main-content">
  <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h1>

  <form id="employeeForm" class="employee-form" th:action="@{/employees/add}" th:object="${employeeForm}" method="post">

    <div class="form-group">
      <label>–§–∞–º–∏–ª–∏—è</label>
      <input type="text" th:field="*{surname}" required>
    </div>

    <div class="form-group">
      <label>–ò–º—è</label>
      <input type="text" th:field="*{name}" required>
    </div>

    <div class="form-group">
      <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
      <input type="text" th:field="*{patronymic}">
    </div>

    <div class="form-group">
      <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
      <select th:field="*{position}">
        <option th:each="pos : ${positions}" th:value="${pos.positionName}" th:text="${pos.positionName}"></option>
      </select>
    </div>

    <div class="form-group">
      <label>–¢–∏–ø –æ–ø–ª–∞—Ç—ã</label>
      <select th:field="*{paymentType}">
        <option value="FIXED">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
        <option value="HOURLY">–ü–æ—á–∞—Å–æ–≤–∞—è</option>
      </select>
    </div>

    <div class="form-group">
      <label>–°—Ç–∞–≤–∫–∞ / –ó–∞—Ä–ø–ª–∞—Ç–∞</label>
      <input type="number" th:field="*{salary}" step="0.01" required>
    </div>

    <div class="form-group">
      <label>–î–∞—Ç–∞ –ø—Ä–∏—ë–º–∞</label>
      <input type="date" th:field="*{hireDate}" required>
    </div>

    <button type="submit" class="submit-btn">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>

  </form>
</div>
</body>
</html>

